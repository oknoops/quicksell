

<div class = 'banner products'>
  <h1> All the products</h1>
</div>

<div class = 'container'>
  <div class = 'row' id='list'>
    <div class='col-md-8 col-md-offset-3'>
      <div class='new-form'>
      <%= form_tag products_path(anchor: 'list'), method: :get do %>
      <%= text_field_tag :km, nil, placeholder: 'Search km' %>
        <%= select_tag :category, options_for_select([ "Books and Magazine", "Movies and Video Games", "High-Tech","Toys and Youth","House and Pets","Beauty and Wellbeing","Retail", "Clothing and Fashion", "Sport and Leisure", "Cars and Mechanics", "Handmade"].sort), include_blank: true%>
        <%= submit_tag "Find Your Happiness", class: "btn btn-primary"%>
      <% end %>
      </div>
    </div>

    <% @products.each do |p| %>
      <% if p.status == "for-sale" %>
        <div class = 'col-sm-12 col-md-6'>
          <a href="/products/<%= p.id %>" style = "text-decoration: none">
            <div class= 'card-product'>
              <% unless p.pictures.nil? %>
                <% if p.pictures.length > 1 %>
                  <div id="carousel-example-generic" class="carousel slide" data-ride="carousel" data-interval="false">

            <!-- Indicators -->
                    <ol class="carousel-indicators">
                      <% p.pictures.each_with_index do |picture, index| %>
                        <li data-target="#carousel-example-generic" data-slide-to="<%= index %>" class="active"></li>
                      <% end %>
                    </ol>


          <!-- Wrapper for slides -->
                    <div class="carousel-inner" role="listbox">
                      <div class="item active">
                        <img src="<%= cl_image_path p.pictures[0].url %>" alt="Picture 1">
                      </div>
                      <% p.pictures.each_with_index do |picture, index| %>
                        <% unless index == 0 %>
                          <div class="item">
                            <img src="<%= cl_image_path picture.url %>" alt="Picture">
                          </div>
                        <% end %>
                        <% if p.user == current_user %>
                        <% end %>
                      <% end %>
                    </div>


            <!-- Controls -->
                  <a class="left carousel-control" href="#carousel-example-generic" role="button" data-slide="prev">
                    <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                    <span class="sr-only">Previous</span>
                  </a>
                  <a class="right carousel-control" href="#carousel-example-generic" role="button" data-slide="next">
                    <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                    <span class="sr-only">Next</span>
                  </a>
                </div>
              <% else %>
                <div class = card-product-image style = "background-image: url(<%= cl_image_path p.pictures.first.url if p.pictures.first %>);">

                </div>
              <% end %>
            <% else %>
              <div class = card-product-image> </div>
            <% end %>

              <div class = 'card-product-description'>
                <% if user_signed_in? %>
                  <div class="card-product-distance">
                    <%=  p.distance_from(current_user.address) ? "#{p.distance_from(current_user.address).round(2)} km" : "" %>
                  </div>
                <% end %>
                <div class = 'card-product-description-name'> <%= p.name %> </div>
                <div class = 'card-product-description-price'> <%= p.price %> â‚¬ </div>
              </div>
            </div>
          </a>
        </div>
      <%end%>
    <%end%>
  </div>
</div>

