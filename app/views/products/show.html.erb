<% content_for :meta_title, "#{@product.name} is on #{DEFAULT_META["meta_product_name"]}" %>
<% content_for :meta_description, @product.description %>
<% content_for :meta_image, cl_image_path(@product.photo.path) %>




<% if @product.pictures[0] %>
  <div class="container">
    <div class="row">
      <div class="col-sm-12 no-gutters-2">

        <div id="carousel-example-generic" class="carousel slide" data-ride="carousel">
    <!-- Indicators -->
          <ol class="carousel-indicators">
            <% @product.pictures.each_with_index do |picture, index| %>
              <li data-target="#carousel-example-generic" data-slide-to="<%= index %>" class="active"></li>
            <% end %>
          </ol>

    <!-- Wrapper for slides -->

          <div class="carousel-inner" role="listbox">
            <div class="item active">
              <img src="<%= cl_image_path @product.pictures[0].url %>" alt="Picture 1">
            </div>
            <% @product.pictures.each_with_index do |picture, index| %>
              <% unless index == 0 %>
                <div class="item">
                  <img src="<%= cl_image_path picture.url %>" alt="Picture">
                </div>
              <% end %>
              <% if @product.user == current_user %>
                <div class="carousel-caption">
                  <%= link_to 'Delete Image', product_picture_path(@product, picture), class: "btn btn-primary", method: :delete, data: { confirm: "Are you sure? Picture won't appear anymore" }  %>
                </div>
              <% end %>
            <% end %>
          </div>


      <!-- Controls -->
          <a class="left carousel-control" href="#carousel-example-generic" role="button" data-slide="prev">
            <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
            <span class="sr-only">Previous</span>
          </a>
          <a class="right carousel-control" href="#carousel-example-generic" role="button" data-slide="next">
            <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
            <span class="sr-only">Next</span>
          </a>
        </div>
      </div>
    </div>
  </div>

<% end %>

<div class="container product-information">
  <div class="row">
    <div class="col-xs-12 col-sm-4">
      <div class = 'product-show-details'>
        <i class="fal fa-money-bill-alt fa-3x logo-product-detail"></i>
        <p><%= @product.price %> â‚¬</p>
      </div>
    </div>
    <div class="col-xs-12 col-sm-4">
      <div class = 'product-show-details'>
        <button id="myBtn">
          <i class="fal fa-map-marker-alt fa-3x logo-product-detail"></i>
          <p><%= @product.pickup_address %></p>
        </button>
      </div>
    </div>
    <div class="col-xs-12 col-sm-4">
      <div class = 'product-show-details'>
        <i class="fal fa-clock fa-3x logo-product-detail"></i>
        <p><%= @product.pickup_time.strftime("%d/%m/%Y") %></p>
        <p><%= @product.pickup_time.strftime("%I:%M%p") %></p>
      </div>
    </div>

    <div class = 'row'>
      <div class = 'col-xs-12 col-sm-12 center'>
        <% if @product.status == "for-sale" && @product.user != current_user %>
          <%= form_tag product_sales_path(@product, @sales) do %>
            <%= hidden_field_tag 'product_id', @product.id, method: :post %>
            <%= submit_tag 'Purchase', class: 'button' %>
          <% end %>
        <% else %>
          <button class = 'button-alternative'>Purchase</button>
        <% end %>
      </div>
    </div>
  </div>
</div>

<hr/>

<div class="container">
  <div class="row">
    <div class="col-sm-12">
      <div class = 'product-information'>
        <h2>Description</h2>
        <h5>Category:  <%= @product.category %> <i class = "<%= @product.category_icon %>"></i></h5>
        <%= @product.description %>
      </div>
    </div>
  </div>
</div>

<hr/>

<div class="container">
  <div class="row">
    <div class="col-sm-12">
      <div class = 'product-information'>
        <div class="col-sm-3 col-sm-offset-1">
          <%= link_to cl_image_tag(@product.user.profile_picture, class: "profile-picture-avatar"), user_path(@product.user) %>
        </div>
        <div class="col-sm-7">
          <h4>Owner : <%= @product.user.first_name %>
          <%= @product.user.last_name %></h4>

          <p> <%= @product.user.profile_description %> </p>
          <% @product.user.average.times do %>
            <i class="fas fa-star"></i>
          <% end %>
          <% (5 - @product.user.average).times do %>
            <i class="far fa-star"></i>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>

<hr/>

<% if @product.user == current_user %>
  <div class="container">
    <div class="row">
      <div class="col-sm-12">
        <div class = 'product-information'>
          <h2>Options</h2>
          <div class = 'col-sm-4'>
            <%= link_to "Delete", product_path(@product), class: 'button', method: :delete, data: { confirm: "Are you sure you want to delete this product?" } %>
          </div>
          <div class = 'col-sm-4'>
            <%= simple_form_for [@product, @picture] do |f| %>
              <%= f.file_field :url %>
              <%= f.hidden_field :url_cache %>
              <%= f.button :submit, class: 'button' %>
            <% end  %>
          </div>
          <div class = 'col-sm-4'>
            <%= link_to "Edit",edit_product_path(@product), class: 'button' %>
          </div>
        </div>
      </div>
    </div>
  </div>
<% end %>

<div id="myModal" class="modal">
  <div style="height: 400px; width: 400px; " class="modal-content">
    <span class="close">&times;</span>
  <div
    id="map"
    style="height: 400px;"
    data-marker="<%= @markers.to_json %>"
  ></div>
  </div>
</div>
